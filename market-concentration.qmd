---
title: "Market Concentration"
---

```{r}
#| label: setup
#| include: false

source("setup.R")

# Add metric labels and combine datasets
hhi_combined <- bind_rows(
  hhi_make |> mutate(metric = "Make"),
  hhi_type |> mutate(metric = "Vehicle Type"),
  hhi_price |> mutate(metric = "Price Bin")
)
```

{{< include chunks/loading-notice.qmd >}}

The [Market Concentration](market-concentration.qmd) page uses the [Herfindahlâ€“Hirschman Index (HHI)](https://en.wikipedia.org/wiki/Herfindahl%E2%80%93Hirschman_Index) to measure how concentrated or competitive each powertrain segment is over time. The HHI ranges from 0 to 1, where values below 0.15 indicate a competitive market, values between 0.15 and 0.25 indicate moderate concentration, and values above 0.25 indicate a highly concentrated market. Concentration is measured across three dimensions: by make, by vehicle type, and by price bin. See the [HHI Explained](hhi-explained.qmd) page for an interactive tool that illustrates how HHI relates to market share distributions.

::: {.panel-tabset}

## Charts

```{r}
#| echo: false

htmltools::tags$iframe(
  src = 'https://019ba305-5eb9-798a-0dd9-7a01ccfc937f.share.connect.posit.cloud/',
  width = "100%",
  height = "800",
  scrolling = "no",
  seamless = "seamless",
  frameBorder = "0"
)
```

## Data

<center>
Download data: [By Make](`r url_hhi_make`) | [By Type](`r url_hhi_type`) | [By Price](`r url_hhi_price`)

<div style="width:900px">

```{r}
#| echo: false

hhi_combined |>
  mutate(
    median = round(median, 3),
    q25 = round(q25, 3),
    q75 = round(q75, 3),
    IQR = round(IQR, 3),
    upper = round(upper, 3),
    lower = round(lower, 3)
  ) |>
  select(metric, powertrain, year, median, q25, q75, IQR, upper, lower) |>
  rename(
    Metric = metric,
    Powertrain = powertrain,
    Year = year,
    Median = median,
    Q25 = q25,
    Q75 = q75,
    Upper = upper,
    Lower = lower
  ) |>
  reactable::reactable(
    searchable = TRUE,
    highlight = TRUE,
    filterable = TRUE,
    defaultPageSize = 10,
    showPageSizeOptions = TRUE,
    pageSizeOptions = c(5, 10, 25, 50),
    defaultColDef = reactable::colDef(
      minWidth = 70
    )
  )
```

</div>
</center>

:::
